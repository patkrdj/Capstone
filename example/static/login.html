<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>블루레이 추천 - 로그인</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', Arial, sans-serif; margin: 0; padding: 0 16px; color: #222; }
    header, footer { padding: 16px 0; }
    header { border-bottom: 1px solid #e5e5e5; }
    footer { border-top: 1px solid #e5e5e5; margin-top: 40px; padding-top: 24px; color: #666; }
    nav a { margin-right: 12px; color: #0366d6; text-decoration: none; }
    nav a:hover { text-decoration: underline; }
    .section { margin: 24px 0; }
    .card { border: 1px dashed #bbb; border-radius: 8px; background: #fafafa; padding: 20px; color: #666; max-width: 420px; margin: 0 auto; }
    .field { display: flex; flex-direction: column; gap: 6px; margin-bottom: 12px; }
    .input { padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; }
    .button { width: 100%; padding: 10px 14px; border: 1px solid #ddd; background: #fff; border-radius: 6px; cursor: pointer; }
    .row { display: flex; gap: 12px; }
  </style>
  <!-- 로그인 화면 와이어프레임 -->
  <!-- 이메일/비밀번호, 소셜 로그인 버튼, 회원가입 링크 -->
</head>
<body>
  <header>
    <nav>
      <strong>BLURAY</strong>
      <a href="/static/home.html">홈</a>
      <a href="/static/search.html">검색</a>
      <a href="/static/login.html">로그인</a>
      <a href="/static/profile.html">프로필</a>
    </nav>
  </header>

  <main>
    <section class="section">
      <h1 style="text-align:center;">로그인</h1>
      <div class="card">
        <form id="login-form">
          <div class="field">
            <label for="usernameOrEmail">아이디 또는 이메일</label>
            <input id="usernameOrEmail" class="input" type="text" placeholder="아이디 또는 이메일" required />
          </div>
          <div class="field">
            <label for="password">비밀번호</label>
            <input id="password" class="input" type="password" placeholder="••••••••" required />
          </div>
          <button class="button" type="submit">로그인</button>
          <div id="login-message" style="text-align:center; margin: 10px 0; color:#999;"></div>
          <div style="margin-top:12px; text-align:center;">
            계정이 없으신가요? <a href="/static/signup.html">회원가입</a>
          </div>
        </form>
        <div style="margin-top:12px; text-align:center;">
          <button class="button" type="button" id="me-button">내 정보 불러오기</button>
        </div>
        <pre id="me-output" style="background:#fafafa; border:1px dashed #bbb; padding:10px; border-radius:6px; margin-top:10px; white-space:pre-wrap;"></pre>
      </div>
    </section>
  </main>

  <footer>
    <div>© 2025 Blu-ray Recommender</div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
  <script>
    const form = document.getElementById('login-form');
    const message = document.getElementById('login-message');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      message.textContent = '';
      message.style.color = '#999';
      const usernameOrEmail = (document.getElementById('usernameOrEmail').value || '').trim();
      const password = document.getElementById('password').value;
      if (!usernameOrEmail || !password) {
        message.style.color = '#d00';
        message.textContent = '아이디/이메일과 비밀번호를 입력하세요.';
        return;
      }
      try {
        const res = await axios.post('/api/login', { usernameOrEmail, password });
        if (res.data && res.data.accessToken) {
          localStorage.setItem('accessToken', res.data.accessToken);
          message.style.color = 'green';
          message.textContent = '로그인 성공! 이동합니다...';
          //window.location.href = '/static/home.html';
        } else {
          message.style.color = '#d00';
          message.textContent = '로그인 응답이 올바르지 않습니다.';
        }
      } catch (err) {
        message.style.color = '#d00';
        if (err.response && err.response.status === 401) {
          message.textContent = '아이디/이메일 또는 비밀번호가 올바르지 않습니다.';
        } else {
          message.textContent = '로그인 중 오류가 발생했습니다.' + (err.message || '');
        }
      }
    });

    const meButton = document.getElementById('me-button');
    const meOutput = document.getElementById('me-output');
    meButton.addEventListener('click', async () => {
      meOutput.textContent = '';
      const token = localStorage.getItem('accessToken');
      if (!token) {
        meOutput.textContent = '토큰이 없습니다. 먼저 로그인하세요.';
        return;
      }
      try {
        const res = await axios.get('/api/me', {
          headers: { Authorization: `Bearer ${token}` }
        });
        meOutput.textContent = JSON.stringify(res.data, null, 2);
      } catch (err) {
        if (err.response) {
          meOutput.textContent = `오류 ${err.response.status}: ${JSON.stringify(err.response.data)}`;
        } else {
          meOutput.textContent = '요청 실패: ' + (err.message || '');
        }
      }
    });
  </script>
</body>
</html>

