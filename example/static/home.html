<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>블루레이 추천 - 홈</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', Arial, sans-serif; margin: 0; padding: 0 16px; color: #222; }
    header, footer { padding: 16px 0; }
    header { border-bottom: 1px solid #e5e5e5; }
    footer { border-top: 1px solid #e5e5e5; margin-top: 40px; padding-top: 24px; color: #666; }
    nav a { margin-right: 12px; color: #0366d6; text-decoration: none; }
    nav a:hover { text-decoration: underline; }
    .section { margin: 24px 0; }
    .hero { border: 1px dashed #bbb; border-radius: 8px; background: #fafafa; padding: 28px; text-align: center; color: #666; }
    .grid { display: grid; gap: 12px; grid-template-columns: repeat(5, 1fr); }
    .card { border: 1px dashed #bbb; border-radius: 8px; background: #fafafa; height: 160px; display: flex; align-items: center; justify-content: center; color: #888; }
    .row { display: flex; gap: 16px; align-items: center; }
    .search-input { flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; }
    .button { padding: 10px 14px; border: 1px solid #ddd; background: #fff; border-radius: 6px; cursor: pointer; }
    h1, h2 { margin: 12px 0; }
  </style>
  <!-- 홈 화면 와이어프레임 -->
  <!-- 상단 내비게이션, 히어로, 카테고리, 추천 섹션 -->
  <!-- 실제 데이터/스타일은 이후에 연결 예정 -->
</head>
<body>
  <header>
    <nav>
      <strong>BLURAY</strong>
      <a href="/static/home.html">홈</a>
      <a href="/static/search.html">검색</a>
      <a href="/static/login.html">로그인</a>
      <a href="/static/profile.html">프로필</a>
    </nav>
  </header>

  <main>
    <section class="section hero">
      <h1>블루레이 추천</h1>
      <p>취향에 맞는 타이틀을 발견해 보세요.</p>
      <div class="row" style="margin-top: 12px;">
        <input class="search-input" type="search" placeholder="제목, 감독, 배우로 검색" />
        <a class="button" href="/static/search.html">검색</a>
      </div>
    </section>

    <section class="section">
      <h2 id="recommendation-title">개인 추천</h2>
      <div class="grid" id="recommendation-grid">
        <div class="card">로그인하면 개인화 추천을 볼 수 있습니다</div>
        <div class="card">추천 로딩 중...</div>
        <div class="card">추천 로딩 중...</div>
        <div class="card">추천 로딩 중...</div>
        <div class="card">추천 로딩 중...</div>
      </div>
    </section>

    <section class="section">
      <h2>인기 블루레이</h2>
      <div class="grid">
        <div class="card" id = "movie-title">카드</div>
        <div class="card">카드</div>
        <div class="card">카드</div>
        <div class="card">카드</div>
        <div class="card">카드</div>
      </div>
    </section>

    <section class="section">
      <h2>새로 나온 타이틀</h2>
      <div class="grid">
        <div class="card">카드</div>
        <div class="card">카드</div>
        <div class="card">카드</div>
        <div class="card">카드</div>
        <div class="card">카드</div>
      </div>
    </section>
  </main>

  <footer>
    <div>© 2025 Blu-ray Recommender</div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
  <script>
    async function fetchMovie() {
      try {
        const response = await axios.get('/api/movies/1');
        const movie = response.data;
        
        document.getElementById('movie-title').textContent = movie.title;
      } catch (error) {
        console.error('영화 가져오기 실패:', error);
        document.getElementById('movie-title').textContent = '영화를 불러올 수 없습니다.';
      }
    }

    async function fetchRecommendations() {
      try {
        const token = localStorage.getItem('accessToken');
        const recommendationGrid = document.getElementById('recommendation-grid');
        const recommendationTitle = document.getElementById('recommendation-title');
        
        if (!token) {
          recommendationTitle.textContent = '개인 추천 (로그인 필요)';
          recommendationGrid.innerHTML = '<div class="card">로그인하면 개인화 추천을 볼 수 있습니다</div>';
          return;
        }
        
        recommendationTitle.textContent = '개인 추천 로딩 중...';
        
        const userId = Number(localStorage.getItem('userId')) || 612;
        // 실행과 동시에 JSON 결과를 받아 바로 사용 (DB 미경유)
        const runRes = await axios.post('/api/recommendations/run', { userId, topN: 5 }, { headers: { Authorization: `Bearer ${token}` }});
        const payload = typeof runRes.data === 'string' ? JSON.parse(runRes.data) : runRes.data;
        const list = Array.isArray(payload?.results) ? payload.results : [];
        
        recommendationTitle.textContent = '개인 추천';
        
        if (list.length === 0) {
          recommendationGrid.innerHTML = '<div class="card">추천 결과가 없습니다</div>';
          return;
        }
        
        // 추천 결과를 카드로 표시
        recommendationGrid.innerHTML = list.map(item => `
          <div class="card" style="cursor: pointer; text-align: center; padding: 12px;" 
               onclick="window.location.href='/static/detail.html?id=${item.saleId || item.movieId}'">
            <div style="font-weight: bold; margin-bottom: 4px;">${item.movieTitle || 'Unknown'}</div>
            <div style="font-size: 12px; color: #666;">유사도: ${(item.similarityScore * 100).toFixed(1)}%</div>
            ${item.reason ? `<div style="font-size: 11px; color: #888; margin-top: 4px;">${item.reason}</div>` : ''}
          </div>
        `).join('');
        
        // 첫 번째 추천 영화를 기존 movie-title에도 표시
        const firstMovie = list[0];
        if (firstMovie) {
          document.getElementById('movie-title').textContent = firstMovie.movieTitle || 'Unknown Movie';
        }
      } catch (e) {
        console.error('추천 불러오기 실패:', e);
        document.getElementById('recommendation-title').textContent = '개인 추천 (오류 발생)';
        document.getElementById('recommendation-grid').innerHTML = '<div class="card">추천을 불러오는데 실패했습니다</div>';
      }
    }

    // 페이지 로드 시 영화/추천 가져오기
    window.addEventListener('DOMContentLoaded', () => { fetchMovie(); fetchRecommendations(); });


  </script>
</body>
</html>

