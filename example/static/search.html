<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>블루레이 추천 - 검색</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', Arial, sans-serif; margin: 0; padding: 0 16px; color: #222; }
    header, footer { padding: 16px 0; }
    header { border-bottom: 1px solid #e5e5e5; }
    footer { border-top: 1px solid #e5e5e5; margin-top: 40px; padding-top: 24px; color: #666; }
    nav a { margin-right: 12px; color: #0366d6; text-decoration: none; }
    nav a:hover { text-decoration: underline; }
    .section { margin: 24px 0; }
    .row { display: flex; gap: 12px; }
    .col { display: flex; flex-direction: column; gap: 8px; }
    .search-input { flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; }
    .button { padding: 10px 14px; border: 1px solid #ddd; background: #fff; border-radius: 6px; cursor: pointer; }
    .filters { border: 1px dashed #bbb; border-radius: 8px; background: #fafafa; padding: 12px; color: #666; }
    .result { border: 1px solid #ddd; border-radius: 8px; background: #fff; padding: 12px; color: #333; display: flex; gap: 12px; align-items: center; cursor: pointer; transition: box-shadow 0.2s; }
    .result:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .poster { width: 72px; height: 100px; border: 1px solid #ddd; border-radius: 6px; background: #f2f2f2; display: flex; align-items: center; justify-content: center; color: #999; font-size: 12px; }
    .list { display: flex; flex-direction: column; gap: 12px; }
    .no-results { text-align: center; color: #666; padding: 40px; font-style: italic; }
    .loading { text-align: center; color: #666; padding: 20px; }
    .movie-info { flex: 1; }
    .movie-title { font-weight: bold; margin-bottom: 4px; }
    .movie-details { font-size: 14px; color: #666; }
    .button:hover { background: #f5f5f5; }
    .search-input:focus { outline: none; border-color: #0366d6; }
  </style>
  <!-- 검색 화면 와이어프레임 -->
  <!-- 검색바, 필터, 결과 리스트 -->
</head>
<body>
  <header>
    <nav>
      <strong>BLURAY</strong>
      <a href="/static/home.html">홈</a>
      <a href="/static/search.html">검색</a>
      <a href="/static/login.html">로그인</a>
      <a href="/static/profile.html">프로필</a>
    </nav>
  </header>

  <main>
    <section class="section">
      <h1>검색</h1>
      <div class="row">
        <input id="searchInput" class="search-input" type="search" placeholder="영화 제목으로 판매 검색" />
        <button id="searchButton" class="button">검색</button>
      </div>
    </section>

    <section class="section">
      <h2>필터</h2>
      <div class="filters row">
        <select>
          <option>장르</option>
        </select>
        <select>
          <option>발매 연도</option>
        </select>
        <select>
          <option>평점</option>
        </select>
        <select>
          <option>정렬: 인기순</option>
        </select>
      </div>
    </section>

    <section class="section">
      <h2>결과</h2>
      <div id="searchResults" class="list">
        <div class="no-results">검색어를 입력하고 검색 버튼을 클릭하세요.</div>
      </div>
    </section>
  </main>

  <footer>
    <div>© 2025 Blu-ray Recommender</div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const searchInput = document.getElementById('searchInput');
      const searchButton = document.getElementById('searchButton');
      const searchResults = document.getElementById('searchResults');

      // 검색 버튼 클릭 이벤트
      searchButton.addEventListener('click', performSearch);
      
      // 엔터키 검색 이벤트
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          performSearch();
        }
      });

      async function performSearch() {
        const query = searchInput.value.trim();
        
        if (!query) {
          searchResults.innerHTML = '<div class="no-results">검색어를 입력해주세요.</div>';
          return;
        }

        // 로딩 표시
        searchResults.innerHTML = '<div class="loading">검색 중...</div>';

        try {
          const response = await fetch(`/api/sales/search?query=${encodeURIComponent(query)}`);
          
          if (!response.ok) {
            throw new Error('검색 요청 실패');
          }

          const sales = await response.json();
          displayResults(sales);

        } catch (error) {
          console.error('검색 오류:', error);
          searchResults.innerHTML = '<div class="no-results">검색 중 오류가 발생했습니다. 다시 시도해주세요.</div>';
        }
      }

      function displayResults(sales) {
        if (sales.length === 0) {
          searchResults.innerHTML = '<div class="no-results">검색 결과가 없습니다.</div>';
          return;
        }

        const resultsHTML = sales.map(sale => `
          <div class="result" onclick="viewSaleDetail(${sale.id}, ${sale.movieId ?? 'null'})">
            <div class="poster">${sale.imageLink ? `<img src="${sale.imageLink}" alt="cover" style="max-width:100%;max-height:100%;" loading="lazy"/>` : '판매'}</div>
            <div class="movie-info">
              <div class="movie-title">${sale.blurayTitle || (sale.siteName || '판매처').toUpperCase()} ${sale.isLimitedEdition ? '[한정판]' : ''}</div>
              <div class="movie-details">
                ${sale.price != null ? `가격: ${Number(sale.price).toLocaleString('ko-KR')}원` : ''}
                ${sale.quality ? ` | 품질: ${sale.quality}` : ''}
                ${sale.regionCode != null ? ` | 지역코드: ${sale.regionCode}` : ''}
                ${sale.movieId != null ? ` | 영화ID: ${sale.movieId}` : ''}
                ${sale.siteUrl ? ` | <a href="${sale.siteUrl}" target="_blank" rel="noopener">바로가기</a>` : ''}
              </div>
            </div>
          </div>
        `).join('');

        searchResults.innerHTML = resultsHTML;
      }

      // 판매 상세로 이동
      window.viewSaleDetail = function(salesId, movieId) {
        window.location.href = `/static/detail.html?id=${salesId}`;
      };
    });
  </script>
</body>
</html>

